<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>My second three.js app</title>
    <style>
        body {
            margin: 0;
			overflow: hidden;
            font-family: Arial, sans-serif;
        }


        /* Style for the container div */
        .container {
            .container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 10%;
        z-index: 1;
        }
        

    </style>
</head>
<body>
    <div id="container"></div>
    
    <!-- Include the "main copy.js" script -->
    <script type="module" src="/main copy.js"></script>

    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script src="node_modules/osc/dist/osc-browser.min.js"></script>

    <script type="module">
        import { TrigPos } from '/main copy.js';


        var port = new osc.WebSocketPort({
            url: "ws://localhost:8081"
        });

        port.on("message", function (oscMessage) {
            $("#message").text(JSON.stringify(oscMessage, undefined, 2));
            console.log("message", oscMessage);
        });

        port.open();

        // Send OSC messages every 100ms
        setInterval(() => {
            //console.log('TrigPos:', TrigPos); // Add this line to log the variable

            // Create three separate OSC messages for x, y, and z
            // AND: HARDCODE to OSC REceiver IEM PLUGIN ROOMENCODER

            
            // Map the x component of TrigPos from [-1000, 1000] to [-15, 15]
            // THE X-VALUE needs to be flipped !! Mapping
            const xMapped = map(TrigPos.x, 1000, -1000, -15, 15);

        // Map the y component of TrigPos from [0, 500] to [0, 10]
        // In the ROOM-ENCODER this is the Z-VALUE
        const zMapped = map(TrigPos.y, 0, 500, 0, 10);

        // Map the z component of TrigPos from [-1000, 1000] to [-15, 15]
        const yMapped = map(TrigPos.z, -1000, 1000, -15, 15);

        // Map a value from one range to another
        function map(value, min1, max1, min2, max2) {
        return (value - min1) * (max2 - min2) / (max1 - min1) + min2;
        }
        /*
        console.log('xMapped:', xMapped);
        console.log('yMapped:', yMapped);
        console.log('zMapped:', zMapped);
        */

            const xMessage = {
                address: '/RoomEncoder/sourceX',
                // Mapping values from -1000 - 1000 to -15 - 15
                args: [{ type: 'f', value: xMapped.toFixed(2) }]
            };
            const yMessage = {
                address: '/RoomEncoder/sourceY',
                args: [{ type: 'f', value: yMapped.toFixed(2) }]
            };
            const zMessage = {
                address: '/RoomEncoder/sourceZ',
                args: [{ type: 'f', value: zMapped.toFixed(2) }]
            };

            // Send the messages over OSC
            port.send(xMessage);
            port.send(yMessage);
            port.send(zMessage);
        }, 100);


    </script>
</body>
</html>
