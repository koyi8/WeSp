<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>My second three.js app</title>
    <style>
        body {
            margin: 0;
			overflow: hidden;
            font-family: Arial, sans-serif;
        }


        /* Style for the container div */
        .container {
            .container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 10%;
        z-index: 1;
        }
        

    </style>
</head>
<body>
    <div id="container"></div>
    
    <!-- Include the "main copy.js" script -->
    <script type="module" src="/main copy.js"></script>

    <!--<script src="node_modules/jquery/dist/jquery.js"></script>
    <script src="node_modules/osc/dist/osc-browser.min.js"></script> -->

    <script  src="/jquery.js"></script>
    <script src="/osc-browser.min.js"></script>


    <script type="module">
        import { exportPositionsArray } from '/main copy.js';


        var port = new osc.WebSocketPort({
            url: "ws://localhost:8081"
        });

        port.on("message", function (oscMessage) {
            $("#message").text(JSON.stringify(oscMessage, undefined, 2));
            console.log("message", oscMessage);
        });

        port.open();

        setInterval(() => {
            // Iterate over the exportPositionsArray
            for (let i = 0; i < exportPositionsArray.length; i++) {
                let TrigPos = exportPositionsArray[i][0];


                // Map the x, y, and z components of TrigPos
                const xMapped = map(TrigPos.x, 1000, -1000, -15, 15);
                const zMapped = map(TrigPos.y, 0, 500, 0, 10);
                const yMapped = map(TrigPos.z, -1000, 1000, -15, 15);

                console.log(`Trigger ${i+1}: X = ${xMapped}, Y = ${yMapped}, Z = ${zMapped}`);

                // Create three separate OSC messages for x, y, and z
                const xMessage = {
                    address: '/RoomEncoder/sourceX' + i,
                    args: [{ type: 'f', value: xMapped.toFixed(2) }]
                };
                const yMessage = {
                    address: '/RoomEncoder/sourceY' + i,
                    args: [{ type: 'f', value: yMapped.toFixed(2) }]
                };
                const zMessage = {
                    address: '/RoomEncoder/sourceZ' + i,
                    args: [{ type: 'f', value: zMapped.toFixed(2) }]
                };

                // Send the messages over OSC
                port.send(xMessage);
                port.send(yMessage);
                port.send(zMessage);
            }
        }, 100);

        // Map a value from one range to another
        function map(value, min1, max1, min2, max2) {
            return (value - min1) * (max2 - min2) / (max1 - min1) + min2;
        }

    </script>
</body>
</html>
